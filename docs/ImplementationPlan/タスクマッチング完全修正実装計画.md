# ã‚¿ã‚¹ã‚¯ãƒãƒƒãƒãƒ³ã‚°å®Œå…¨ä¿®æ­£å®Ÿè£…è¨ˆç”»

## ç·Šæ€¥ä¿®æ­£ãŒå¿…è¦ãªæ ¹æœ¬å•é¡Œ

### ç¾åœ¨ã®è‡´å‘½çš„ãªè¨­è¨ˆæ¬ é™¥
- **å•é¡Œ**: `GetTargetItemForTeam()`ãŒã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¿ã‚¹ã‚¯ã®ã¿ã‚’ãƒã‚§ãƒƒã‚¯
- **çµæœ**: ãƒãƒ¼ãƒ ã‚¿ã‚¹ã‚¯ã‚’å‰Šé™¤ã—ã¦ã‚‚ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¿ã‚¹ã‚¯ãŒæ®‹ã£ã¦ã„ã‚Œã°ç¶™ç¶šå®Ÿè¡Œã•ã‚Œã‚‹
- **æ­£ã—ã„è¨­è¨ˆ**: ãƒãƒ¼ãƒ ã‚¿ã‚¹ã‚¯å„ªå…ˆåº¦ â†’ ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¿ã‚¹ã‚¯ãƒãƒƒãƒãƒ³ã‚°

### ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æœŸå¾…ã™ã‚‹æ­£ã—ã„å‹•ä½œ
```
ä¾‹: 
Global Tasks:
  - æ¡é›†: çŸ³ (å„ªå…ˆåº¦1)
  - å†’é™º: å…¨ã¦ (å„ªå…ˆåº¦2)

Team Tasks:
  - å†’é™º: å¹³åŸ (å„ªå…ˆåº¦1)
  - æ¡é›† (å„ªå…ˆåº¦2)

çµæœ: å†’é™ºãƒ»å¹³åŸãŒé¸æŠã•ã‚Œã‚‹ï¼ˆãƒãƒ¼ãƒ å„ªå…ˆåº¦ãŒæœ€å„ªå…ˆï¼‰
```

## Phase 1: ã‚¿ã‚¹ã‚¯ãƒãƒƒãƒãƒ³ã‚°ãƒ­ã‚¸ãƒƒã‚¯ã®å®Œå…¨å†è¨­è¨ˆ

### 1.1 ãƒ¡ã‚¤ãƒ³é–¢æ•°ã®å®Œå…¨æ›¸ãæ›ãˆ (`TaskManagerComponent.cpp`)

```cpp
FString UTaskManagerComponent::GetTargetItemForTeam(int32 TeamIndex, const FString& LocationId) const
{
    UE_LOG(LogTemp, Warning, TEXT("ğŸ” TASK MATCHING: Team %d at %s"), TeamIndex, *LocationId);
    
    if (!IsValid(TeamComponentRef)) {
        UE_LOG(LogTemp, Error, TEXT("âŒ TeamComponent unavailable"));
        return FString();
    }
    
    // 1. ãƒãƒ¼ãƒ ã‚¿ã‚¹ã‚¯ã‚’å„ªå…ˆåº¦é †ã§å–å¾—
    TArray<FTeamTask> TeamTasks = TeamComponentRef->GetTeamTasks(TeamIndex);
    UE_LOG(LogTemp, Warning, TEXT("ğŸ“‹ Team has %d tasks"), TeamTasks.Num());
    
    if (TeamTasks.Num() == 0) {
        UE_LOG(LogTemp, Warning, TEXT("âŒ NO TEAM TASKS - Team %d returning to base"), TeamIndex);
        return FString(); // ãƒãƒ¼ãƒ ã‚¿ã‚¹ã‚¯ãªã— â†’ æ‹ ç‚¹å¸°é‚„
    }
    
    // 2. ãƒãƒ¼ãƒ ã‚¿ã‚¹ã‚¯ã®å„ªå…ˆåº¦é †ã§ãƒãƒƒãƒãƒ³ã‚°æ¤œç´¢
    for (int32 i = 0; i < TeamTasks.Num(); i++) {
        const FTeamTask& TeamTask = TeamTasks[i];
        FString TaskTypeName = UTaskTypeUtils::GetTaskTypeDisplayName(TeamTask.TaskType);
        
        UE_LOG(LogTemp, Warning, TEXT("ğŸ¯ Priority %d: %s"), i+1, *TaskTypeName);
        
        // 3. ã“ã®ãƒãƒ¼ãƒ ã‚¿ã‚¹ã‚¯ã«å¯¾å¿œã™ã‚‹ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¿ã‚¹ã‚¯ã‚’æ¢ã™
        FString MatchedTarget = FindMatchingGlobalTask(TeamTask, TeamIndex, LocationId);
        
        if (!MatchedTarget.IsEmpty()) {
            UE_LOG(LogTemp, Warning, TEXT("âœ… MATCHED: %s for %s"), *MatchedTarget, *TaskTypeName);
            return MatchedTarget; // æœ€åˆã«ãƒãƒƒãƒã—ãŸã‚‚ã®ã‚’è¿”ã™
        } else {
            UE_LOG(LogTemp, Warning, TEXT("âŒ NO MATCH for %s"), *TaskTypeName);
        }
    }
    
    UE_LOG(LogTemp, Warning, TEXT("âŒ NO MATCHES FOUND - Team %d returning to base"), TeamIndex);
    return FString(); // å…¨ã¦ã®ãƒãƒ¼ãƒ ã‚¿ã‚¹ã‚¯ã§ãƒãƒƒãƒã—ãªã„ â†’ æ‹ ç‚¹å¸°é‚„
}
```

### 1.2 ã‚¿ã‚¹ã‚¯ã‚¿ã‚¤ãƒ—åˆ¥ãƒãƒƒãƒãƒ³ã‚°é–¢æ•°ã®è¿½åŠ 

```cpp
FString UTaskManagerComponent::FindMatchingGlobalTask(const FTeamTask& TeamTask, int32 TeamIndex, const FString& LocationId) const
{
    switch (TeamTask.TaskType) {
        case ETaskType::Gathering:
            return FindMatchingGatheringTask(TeamIndex, LocationId);
            
        case ETaskType::Adventure:
            return FindMatchingAdventureTask(TeamIndex, LocationId);
            
        case ETaskType::Construction:
            return FindMatchingConstructionTask(TeamIndex);
            
        case ETaskType::Cooking:
            return FindMatchingCookingTask(TeamIndex);
            
        case ETaskType::Crafting:
            return FindMatchingCraftingTask(TeamIndex);
            
        default:
            UE_LOG(LogTemp, Warning, TEXT("âš ï¸ Unhandled team task type: %d"), (int32)TeamTask.TaskType);
            return FString();
    }
}
```

## Phase 2: æ¡é›†ã‚¿ã‚¹ã‚¯ãƒãƒƒãƒãƒ³ã‚°ã®è©³ç´°å®Ÿè£…

### 2.1 æ¡é›†ã‚¿ã‚¹ã‚¯å°‚ç”¨ãƒãƒƒãƒãƒ³ã‚°é–¢æ•°

```cpp
FString UTaskManagerComponent::FindMatchingGatheringTask(int32 TeamIndex, const FString& LocationId) const
{
    UE_LOG(LogTemp, VeryVerbose, TEXT("  ğŸ” Searching gathering tasks at %s"), *LocationId);
    
    // ãã®å ´æ‰€ã§æ¡é›†å¯èƒ½ãªã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¿ã‚¹ã‚¯ã‚’å„ªå…ˆåº¦é †ã§å–å¾—
    TArray<FGlobalTask> ExecutableTasks = GetExecutableGatheringTasksAtLocation(TeamIndex, LocationId);
    
    UE_LOG(LogTemp, VeryVerbose, TEXT("  ğŸ“Š Found %d executable gathering tasks"), ExecutableTasks.Num());
    
    if (ExecutableTasks.Num() > 0) {
        const FGlobalTask& SelectedTask = ExecutableTasks[0]; // æœ€å„ªå…ˆ
        UE_LOG(LogTemp, VeryVerbose, TEXT("  âœ… Selected: %s"), *SelectedTask.TargetItemId);
        return SelectedTask.TargetItemId;
    }
    
    UE_LOG(LogTemp, VeryVerbose, TEXT("  âŒ No gathering tasks available at %s"), *LocationId);
    return FString();
}
```

### 2.2 ä»–ã®ã‚¿ã‚¹ã‚¯ã‚¿ã‚¤ãƒ—ç”¨ã®ã‚¹ã‚¿ãƒ–å®Ÿè£…

```cpp
FString UTaskManagerComponent::FindMatchingAdventureTask(int32 TeamIndex, const FString& LocationId) const
{
    UE_LOG(LogTemp, VeryVerbose, TEXT("  ğŸ”ï¸ Adventure task matching (not implemented)"));
    // TODO: å†’é™ºã‚·ã‚¹ãƒ†ãƒ å®Ÿè£…æ™‚ã«è¿½åŠ 
    return FString();
}

FString UTaskManagerComponent::FindMatchingConstructionTask(int32 TeamIndex) const
{
    UE_LOG(LogTemp, VeryVerbose, TEXT("  ğŸ—ï¸ Construction task matching (not implemented)"));
    // TODO: å»ºç¯‰ã‚·ã‚¹ãƒ†ãƒ å®Ÿè£…æ™‚ã«è¿½åŠ 
    return FString();
}

FString UTaskManagerComponent::FindMatchingCookingTask(int32 TeamIndex) const
{
    UE_LOG(LogTemp, VeryVerbose, TEXT("  ğŸ³ Cooking task matching (not implemented)"));
    // TODO: æ–™ç†ã‚·ã‚¹ãƒ†ãƒ å®Ÿè£…æ™‚ã«è¿½åŠ 
    return FString();
}

FString UTaskManagerComponent::FindMatchingCraftingTask(int32 TeamIndex) const
{
    UE_LOG(LogTemp, VeryVerbose, TEXT("  âš’ï¸ Crafting task matching (not implemented)"));
    // TODO: è£½ä½œã‚·ã‚¹ãƒ†ãƒ å®Ÿè£…æ™‚ã«è¿½åŠ 
    return FString();
}
```

## Phase 3: ãƒ˜ãƒƒãƒ€ãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«ã®æ›´æ–°

### 3.1 TaskManagerComponent.h ã¸ã®é–¢æ•°å®£è¨€è¿½åŠ 

```cpp
private:
    // ã‚¿ã‚¹ã‚¯ãƒãƒƒãƒãƒ³ã‚°ç”¨ã®ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°
    FString FindMatchingGlobalTask(const FTeamTask& TeamTask, int32 TeamIndex, const FString& LocationId) const;
    FString FindMatchingGatheringTask(int32 TeamIndex, const FString& LocationId) const;
    FString FindMatchingAdventureTask(int32 TeamIndex, const FString& LocationId) const;
    FString FindMatchingConstructionTask(int32 TeamIndex) const;
    FString FindMatchingCookingTask(int32 TeamIndex) const;
    FString FindMatchingCraftingTask(int32 TeamIndex) const;
```

## Phase 4: å®Ÿè£…é †åºã¨æ¤œè¨¼

### Step 1: ãƒ˜ãƒƒãƒ€ãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«æ›´æ–°
1. `TaskManagerComponent.h`ã«æ–°ã—ã„é–¢æ•°ã‚’å®£è¨€
2. **ãƒªãƒ“ãƒ«ãƒ‰å¿…é ˆ** (ãƒ˜ãƒƒãƒ€ãƒ¼å¤‰æ›´ã®ãŸã‚)

### Step 2: å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«æ›´æ–°
1. `GetTargetItemForTeam()`ã‚’å®Œå…¨æ›¸ãæ›ãˆ
2. `FindMatchingGlobalTask()`ã‚’å®Ÿè£…
3. `FindMatchingGatheringTask()`ã‚’å®Ÿè£…
4. ä»–ã®ã‚¿ã‚¹ã‚¯ã‚¿ã‚¤ãƒ—ç”¨ã‚¹ã‚¿ãƒ–é–¢æ•°ã‚’å®Ÿè£…
5. **ãƒ©ã‚¤ãƒ–ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°å¯** (å®Ÿè£…ã®ã¿)

### Step 3: ãƒ†ã‚¹ãƒˆã‚·ãƒŠãƒªã‚ª

#### 3.1 æ­£å¸¸å‹•ä½œç¢ºèª
- ãƒãƒ¼ãƒ ã‚¿ã‚¹ã‚¯ï¼ˆæ¡é›†ï¼‰+ ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¿ã‚¹ã‚¯ï¼ˆçŸ³æ¡é›†ï¼‰ â†’ æ¡é›†å®Ÿè¡Œ
- ãƒãƒ¼ãƒ ã‚¿ã‚¹ã‚¯ï¼ˆå†’é™ºâ†’æ¡é›†ï¼‰+ ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¿ã‚¹ã‚¯ï¼ˆçŸ³æ¡é›†ï¼‰ â†’ å†’é™ºå„ªå…ˆï¼ˆã‚¹ã‚¿ãƒ–ãªã®ã§æ‹ ç‚¹å¸°é‚„ï¼‰

#### 3.2 å‰Šé™¤æ™‚å‹•ä½œç¢ºèª
- å®Ÿè¡Œä¸­ã«ãƒãƒ¼ãƒ ã‚¿ã‚¹ã‚¯å‰Šé™¤ â†’ æ¬¡ã‚¿ãƒ¼ãƒ³ã§æ‹ ç‚¹å¸°é‚„
- ãƒ­ã‚°ã§ã€ŒNO TEAM TASKSã€ãŒå‡ºåŠ›ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª

#### 3.3 è¤‡æ•°ã‚¿ã‚¹ã‚¯å„ªå…ˆåº¦ç¢ºèª
- ãƒãƒ¼ãƒ ã‚¿ã‚¹ã‚¯è¤‡æ•°è¨­å®šæ™‚ã®å„ªå…ˆåº¦é †å‡¦ç†
- æœ€åˆã«ãƒãƒƒãƒã—ãŸã‚¿ã‚¹ã‚¯ãŒé¸æŠã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª

## Phase 5: ãƒ­ã‚°ã«ã‚ˆã‚‹å‹•ä½œç¢ºèª

### æœŸå¾…ã•ã‚Œã‚‹ãƒ­ã‚°å‡ºåŠ›ä¾‹

#### æ­£å¸¸æ™‚
```
ğŸ” TASK MATCHING: Team 0 at plains
ğŸ“‹ Team has 2 tasks
ğŸ¯ Priority 1: å†’é™º
âŒ NO MATCH for å†’é™º
ğŸ¯ Priority 2: æ¡é›†
âœ… MATCHED: stone for æ¡é›†
```

#### ãƒãƒ¼ãƒ ã‚¿ã‚¹ã‚¯å‰Šé™¤å¾Œ
```
ğŸ” TASK MATCHING: Team 0 at plains
ğŸ“‹ Team has 0 tasks
âŒ NO TEAM TASKS - Team 0 returning to base
```

## Phase 6: é‡è¦ãªæ³¨æ„ç‚¹

### 6.1 ã‚¿ãƒ¼ãƒ³ãƒ™ãƒ¼ã‚¹åŸå‰‡ã®å³å®ˆ
- æ¯ã‚¿ãƒ¼ãƒ³å®Œå…¨å†è¨ˆç®—
- ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãªã—ã€çŠ¶æ…‹æŒã¡è¶Šã—ãªã—
- `GetTeamTasks()`ã¯å¸¸ã«æœ€æ–°çŠ¶æ…‹ã‚’è¿”ã™

### 6.2 å„ªå…ˆåº¦ã®å³æ ¼ãªå®Ÿè£…
- ãƒãƒ¼ãƒ ã‚¿ã‚¹ã‚¯ã®é…åˆ—é † = å„ªå…ˆåº¦é †
- æœ€åˆã«ãƒãƒƒãƒã—ãŸã‚¿ã‚¹ã‚¯ã‚’å³åº§ã«é¸æŠ
- ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¿ã‚¹ã‚¯ã®å„ªå…ˆåº¦ã¯ãƒãƒ¼ãƒ ã‚¿ã‚¹ã‚¯ãŒæ±ºã¾ã£ãŸå¾Œã«é©ç”¨

### 6.3 ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
- ãƒãƒ¼ãƒ ã‚¿ã‚¹ã‚¯ãªã— â†’ æ‹ ç‚¹å¸°é‚„
- ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¿ã‚¹ã‚¯ãªã— â†’ æ‹ ç‚¹å¸°é‚„
- ãƒãƒƒãƒãƒ³ã‚°ãªã— â†’ æ‹ ç‚¹å¸°é‚„

## å®Ÿè£…æ™‚ã®ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

- [ ] ãƒ˜ãƒƒãƒ€ãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«ã«æ–°é–¢æ•°ã‚’å®£è¨€
- [ ] ã‚¨ãƒ‡ã‚£ã‚¿ã‚’é–‰ã˜ã¦å®Œå…¨ãƒªãƒ“ãƒ«ãƒ‰
- [ ] `GetTargetItemForTeam()`ã‚’å®Œå…¨æ›¸ãæ›ãˆ
- [ ] ãƒãƒƒãƒãƒ³ã‚°é–¢æ•°ç¾¤ã‚’å®Ÿè£…
- [ ] ãƒ­ã‚°å‡ºåŠ›ã§å‹•ä½œã‚’ç¢ºèª
- [ ] ãƒãƒ¼ãƒ ã‚¿ã‚¹ã‚¯å‰Šé™¤ãƒ†ã‚¹ãƒˆ
- [ ] è¤‡æ•°ã‚¿ã‚¹ã‚¯å„ªå…ˆåº¦ãƒ†ã‚¹ãƒˆ

## æœŸå¾…ã•ã‚Œã‚‹ä¿®æ­£åŠ¹æœ

1. **å³åº§åæ˜ **: ãƒãƒ¼ãƒ ã‚¿ã‚¹ã‚¯å‰Šé™¤ â†’ æ¬¡ã‚¿ãƒ¼ãƒ³ã§æ‹ ç‚¹å¸°é‚„
2. **æ­£ç¢ºãªå„ªå…ˆåº¦**: ãƒãƒ¼ãƒ ã‚¿ã‚¹ã‚¯ã®å„ªå…ˆåº¦é †ã§ãƒãƒƒãƒãƒ³ã‚°
3. **ãƒ‡ãƒãƒƒã‚°å®¹æ˜“**: ãƒ­ã‚°ã§ãƒãƒƒãƒãƒ³ã‚°éç¨‹ãŒå®Œå…¨ã«è¿½è·¡å¯èƒ½
4. **å°†æ¥æ‹¡å¼µ**: ä»–ã®ã‚¿ã‚¹ã‚¯ã‚¿ã‚¤ãƒ—ã‚‚åŒã˜ä»•çµ„ã¿ã§è¿½åŠ å¯èƒ½

ã“ã®è¨ˆç”»ã«ã‚ˆã‚Šã€ã‚¿ã‚¹ã‚¯ãƒãƒƒãƒãƒ³ã‚°ã‚·ã‚¹ãƒ†ãƒ ã®æ ¹æœ¬çš„ãªè¨­è¨ˆæ¬ é™¥ãŒä¿®æ­£ã•ã‚Œã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æœŸå¾…é€šã‚Šã®å‹•ä½œãŒå®Ÿç¾ã•ã‚Œã¾ã™ã€‚